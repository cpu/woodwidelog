<!doctype html><html><head lang=en><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Carcinisation - Wood Wide Log</title><meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Snowshoeing, NAWS, Trust-DNS."><meta property="og:image" content><meta property="og:url" content="https://log.woodweb.ca/2023/01/carcinisation/"><meta property="og:site_name" content="Wood Wide Log"><meta property="og:title" content="Carcinisation"><meta property="og:description" content="Snowshoeing, NAWS, Trust-DNS."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-01-15T08:00:00-04:00"><meta property="article:modified_time" content="2023-01-15T08:00:00-04:00"><meta property="og:image" content="https://log.woodweb.ca/2023/01/carcinisation/feature.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://log.woodweb.ca/2023/01/carcinisation/feature.jpg"><meta name=twitter:title content="Carcinisation"><meta name=twitter:description content="Snowshoeing, NAWS, Trust-DNS."><script src=https://log.woodweb.ca/js/feather.min.js></script><link href=https://log.woodweb.ca/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://log.woodweb.ca/css/main.5cebd7d4fb2b97856af8d32a6def16164fcf7d844e98e236fcb3559655020373.css><link rel=stylesheet type=text/css href=https://log.woodweb.ca/css/custom.d10d882a0feb2833d6bb41c11b088fd0710c01566f5092017beb42fa48bc7762.css></head><body><div class=content><header><div class=main><a href=https://log.woodweb.ca/>Wood Wide Log</a></div><nav><a href=/>Log</a>
<a href=/articles>Articles</a>
<a href=/posts>Archive</a>
<a href=/about>About</a></nav></header><main><article><div class=title><h1 class=title>Carcinisation</h1><div class=meta>Posted on Jan 15, 2023</div></div><section class=body><p>Winter has blessed my area with ample snow. January is a classic prompt for
evaluating one&rsquo;s shit and I can get a lot of thinking done in the pockets of
silence a snowy forest provides. Lately I&rsquo;m thinking a lot about trusting
myself. I&rsquo;m ready to take some bigger swings even if a few might miss.</p><p><img src=./snowshoe.jpg alt=Snowshoeing></p><h1 id=lately>Lately</h1><p>I&rsquo;ve dabbled with the Rust programming language a few times over the past few
years but haven&rsquo;t hit the tipping point where it feels <em>comfortable</em>. The past
month or so I&rsquo;ve been trying to find excuses to address that by getting my hands
dirty where I can.</p><h2 id=blightmud-naws-support>Blightmud NAWS Support</h2><p>Readers of this log (<em>uncountably numerous, I&rsquo;m sure</em>) will remember <a href=https://github.com/blightmud/blightmud>Blightmud</a>
coming up <a href=https://log.woodweb.ca/2022/10/slow-moving/>in a previous post</a> where I discussed some challenges
I encountered writing a Nixpkgs derivation to package it. <strong>TLDR:</strong> Blightmud is
a souped up Telnet client for <a href=https://en.wikipedia.org/wiki/MUD>MUDs</a> written in Rust, with scripting provided by
Lua.</p><p>Over the holidays I was working on some fancy server-side text rendering code
for displaying MUD data in a table format. Making layout decisions about column
widths and the number of rows to display requires having some sense of how big
the client&rsquo;s terminal window is. Fortunately, way back in 1988 the IETF network
working group proposed a standard (<a href=https://www.rfc-editor.org/rfc/rfc1073>RFC 1073</a>) that describes a way for a telnet
server and client to &ldquo;Negotiate About Window Size&rdquo; (NAWS). This happens
out-of-band from the output presented to the user and is automatically updated
if the client window is resized. Perfect!</p><p><em>Only one catch&mldr;</em> While other clients like <a href=https://tintin.mudhalla.net/>Tintin++</a> and <a href=https://mudlet.org/>Mudlet</a>
already supported NAWS, Blightmud did not. &#9785;&#xfe0f;</p><p>In some ways this was actually fortunate! It gave me a chance to dig into the
codebase and <a href=https://github.com/Blightmud/Blightmud/commit/35bd9bebe682a85cb46f5b7ef9af0b18a54772e5>implement it</a> myself. Because the Telnet negotiation logic was
already exposed to Lua it didn&rsquo;t even require very much Rust to accomplish. The
only significant Rust change was implementing a new event handler
(<a href="https://github.com/Blightmud/Blightmud/blob/35bd9bebe682a85cb46f5b7ef9af0b18a54772e5/resources/help/lua_blight.md?plain=1#L35-L44"><code>blight.on_dimensions_change</code></a>) exposed to the Lua code
so that we could perform NAWS updates whenever the terminal window changed
dimensions. From there all the interesting bits happen in <a href=https://github.com/Blightmud/Blightmud/blob/35bd9bebe682a85cb46f5b7ef9af0b18a54772e5/resources/lua/naws.lua>pure Lua</a>.</p><p>While I was kicking around I also fixed a flaky <a href=https://github.com/Blightmud/Blightmud/commit/761823ea34d7a01e665d2608fd2c1a0933d02ec2><code>ndk-sys</code> checksum
err</a>, and a small <a href=https://github.com/Blightmud/Blightmud/commit/08815e8a403507040bbeee2005b37224af18495c>GMCP interop. gotcha</a>. Both trivial
changes.</p><h2 id=trust-dns>Trust-DNS</h2><p>For a long time I&rsquo;ve hosted my own authoritative DNS zones, first with <a href=https://www.isc.org/bind/>BIND</a> and
then later with <a href=https://www.knot-dns.cz/>Knot</a>. While it&rsquo;s certainly easier to use a hosted DNS service
from your registrar or hosting provider it&rsquo;s definitely a lot more educational
to do it yourself. I&rsquo;m generally happy with Knot, but sure would love to have an
alternative that was written in a memory safe language. DNS is at that perfectly
terrifying intersection of performance critical code and having to parse complex
and untrusted data from a network socket. For that reason I was stoked when
<a href=https://www.memorysafety.org/>ISRG&rsquo;s Prossimo project</a> announced support for a DNS initiative
<a href=https://www.memorysafety.org/initiative/dns/>supporting Trust-DNS</a>, a suite of DNS software written in Rust.</p><p>After whipping up a quick Nix derivation (<em>I haven&rsquo;t cleaned this up for
Nixpkgs yet, stay tuned</em>) I decided to try and take <a href=https://github.com/hickory-dns/hickory-dns>Trust-DNS</a> for a spin with
my zone data. I hit a couple snags right away which made for a great chance to
roll my sleeves up.</p><p>The first snag was simple: I was spinning my wheels looking for a <code>named</code> binary
that was referenced in the README instructions but that wasn&rsquo;t being produced by
my derivation, or a vanilla <code>cargo</code> build. It turned out this was just bad
timing, the project only <a href=https://github.com/hickory-dns/hickory-dns/pull/1859>recently switched</a> to preferring a <code>trust-dns</code> binary
name. I was able to <a href=https://github.com/hickory-dns/hickory-dns/pull/1873>clean up the remaining references</a> with some
<code>grep</code>/<code>sed</code> magic.</p><p>The second snag was more interesting: the zone data files I had been carrying
around for ~10 years were failing to parse with an error like:</p><blockquote><p>Error { kind: Message(&ldquo;record class not specified&rdquo;) }'</p></blockquote><p>Much like the error claims, none of my records specified a record class. It
seems this never came up for me before now because both Knot and BIND would
parse these zones by implicitly assuming they were class IN (for &ldquo;INternet&rdquo;).
(<em>99.9999% of the time this is the only choice that makes sense in 2023</em>).</p><p>Deciding who&rsquo;s at fault here, my zone files or trust-dns, required digging in to
<a href=https://datatracker.ietf.org/doc/html/rfc1035>RFC 1035</a>, and specifically, ยง5 <a href=https://datatracker.ietf.org/doc/html/rfc1035#autoid-48>MASTER FILES</a>. On the topic of class fields that
section says:</p><blockquote><p>The RR begins with optional TTL and class fields, followed by a type and RDATA
field appropriate to the type and class. Class and type use the standard
mnemonics, TTL is a decimal integer. Omitted class and TTL values are default
to the last explicitly stated values.</p></blockquote><p>In classic RFC fashion this isn&rsquo;t very helpful if you&rsquo;re considering a case
where there <em>isn&rsquo;t any</em> explicitly stated value. The class and TTL are both
optional, so what do you do when zero records specify a class? In this case,
like most areas where the RFCs are vague, most folks just Do What BIND
Does&#8482;&#xfe0f;. For this situation that means &ldquo;assume the class is IN&rdquo;.</p><p>I whipped up <a href=https://github.com/hickory-dns/hickory-dns/pull/1874>a small PR</a> to adopt this behaviour and <code>trust-dns</code> was able to
parse my zones without any other changes. &#x1f389; Folks seem in agreement that
supporting this type of zone file is sensible so we&rsquo;re just waiting on some
other review details to be sorted out. Along the way I also <a href=https://github.com/hickory-dns/hickory-dns/pull/1877>fixed</a> a small
<code>cargo audit</code> CI failure with a trivial dep. bump.</p><p>Trust-DNS isn&rsquo;t quite ready to replace Knot for my use-cases but I&rsquo;m excited to
try and help it get it there.</p><h1 id=thinking-about>Thinking about</h1><p><img src=./happyrock.jpg alt="Happy rock"></p><ul><li><a href=https://en.wikipedia.org/wiki/Happy_Rock>Happy Rock</a> - a glorious roadside attraction <em>slash</em> information centre for
Gladstone Manitoba. What a dapper looking rock.</li><li><a href=https://veggie.dog/>Veggie Dog</a> - my (<em>much smarter and much more talented</em>) love has a blog of
her own. You should read it. The writing is fantastic and a lot less fractured
than my own.</li><li><a href=https://cohost.org/cathoderaydude/post/796581-bowling-servers>Bowling Servers</a> - hat tip to <a href=https://cohost.org/cathoderaydude>Cathode Ray Dude</a> for surfacing this niche.
It&rsquo;s amazing what you can do with a few pixels of grayscale input.</li></ul><h1 id=until-next-time>Until next time</h1><p><img src=./glitter.jpg alt=Glitter></p></section><div class=post-tags></div></article></main><footer><div style=display:flex><a class=soc href=https://log.woodweb.ca/index.xml title=RSS><i data-feather=rss></i></a>
<a class=border></a><a class=soc href=https://github.com/cpu/woodwidelog title=GitHub><i data-feather=github></i></a>
<a class=border></a><a class=soc href=https://twitter.com/cpu/ title=Twitter><i data-feather=twitter></i></a>
<a class=border></a></div><div class=footer-info>2025 Daniel McCarney</div></footer><script>feather.replace()</script></div></body></html>